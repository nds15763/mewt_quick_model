<!DOCTYPE html>
<!--
  Deep Mewté€šè®¯æµ‹è¯•é¡µé¢
  
  åŠŸèƒ½ï¼š
  1. æ¨¡æ‹ŸRNå‘é€deepmewtçŠ¶æ€åˆ‡æ¢æ¶ˆæ¯
  2. æµ‹è¯•WebViewæ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯çš„åŠŸèƒ½
  3. éªŒè¯çŠ¶æ€ç®¡ç†å’Œå“åº”æœºåˆ¶
  
  æµ‹è¯•åœºæ™¯ï¼š
  - å¯ç”¨Deep Mewtæ¨¡å¼
  - ç¦ç”¨Deep Mewtæ¨¡å¼
  - é”™è¯¯æ¶ˆæ¯å¤„ç†
  - çŠ¶æ€ç¡®è®¤å“åº”
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deep Mewté€šè®¯æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    
    .test-button:hover {
      background: #0056b3;
    }
    
    .test-button.danger {
      background: #dc3545;
    }
    
    .test-button.danger:hover {
      background: #c82333;
    }
    
    .status-display {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
      font-family: monospace;
    }
    
    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    
    .log-time {
      color: #666;
      font-size: 12px;
    }
    
    .status-on {
      color: #28a745;
      font-weight: bold;
    }
    
    .status-off {
      color: #dc3545;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ§  Deep Mewté€šè®¯æµ‹è¯•</h1>
  
  <div class="test-panel">
    <h3>ğŸ“± æ¨¡æ‹ŸRNæ¶ˆæ¯å‘é€</h3>
    <p>ç‚¹å‡»æŒ‰é’®æ¨¡æ‹ŸReact Nativeå‘é€deepmewtçŠ¶æ€åˆ‡æ¢æ¶ˆæ¯ï¼š</p>
    
    <button class="test-button" onclick="sendDeepMewtToggle(true)">
      ğŸŸ¢ å¯ç”¨Deep Mewtæ¨¡å¼
    </button>
    
    <button class="test-button" onclick="sendDeepMewtToggle(false)">
      ğŸ”´ ç¦ç”¨Deep Mewtæ¨¡å¼
    </button>
    
    <button class="test-button danger" onclick="sendInvalidMessage()">
      âŒ å‘é€æ— æ•ˆæ¶ˆæ¯ï¼ˆæµ‹è¯•é”™è¯¯å¤„ç†ï¼‰
    </button>
  </div>
  
  <div class="test-panel">
    <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
    <div class="status-display">
      <div>Deep MewtçŠ¶æ€: <span id="status-display" class="status-off">OFF</span></div>
      <div>æœ€åæ›´æ–°: <span id="last-update">æœªæ›´æ–°</span></div>
    </div>
  </div>
  
  <div class="test-panel">
    <h3>ğŸ“ æ¶ˆæ¯æ—¥å¿—</h3>
    <div id="message-log" class="status-display">
      <div class="log-entry">ç­‰å¾…æ¶ˆæ¯...</div>
    </div>
  </div>
  
  <div class="test-panel">
    <h3>ğŸ”„ RNå“åº”æ¶ˆæ¯</h3>
    <div id="rn-response-log" class="status-display">
      <div class="log-entry">ç­‰å¾…å“åº”...</div>
    </div>
  </div>

  <script>
    // åˆå§‹åŒ–Deep MewtçŠ¶æ€
    window.DEEP_MEWT_ENABLED = false;
    
    // æ¶ˆæ¯æ—¥å¿—
    const messageLog = [];
    const rnResponseLog = [];
    
    // æ¨¡æ‹ŸsendToRNå‡½æ•°ï¼ˆè®°å½•å“åº”æ¶ˆæ¯ï¼‰
    window.sendToRN = function(text, source, state, metadata = {}) {
      const message = {
        type: 'text_update',
        text,
        source,
        state,
        timestamp: Date.now(),
        metadata
      };
      
      addRNResponseLog(`[å“åº”] ${text}`, JSON.stringify(metadata, null, 2));
      console.log('[â†’ RN] æ¨¡æ‹Ÿå‘é€:', message);
    };
    
    // æ·»åŠ æ¶ˆæ¯ç›‘å¬å™¨ï¼ˆä¸å®é™…é¡¹ç›®ç›¸åŒçš„é€»è¾‘ï¼‰
    window.addEventListener('message', function(event) {
      try {
        const data = JSON.parse(event.data);
        addMessageLog(`[æ”¶åˆ°] ${data.type}`, JSON.stringify(data, null, 2));
        
        if (data.type === 'deep_mewt_toggle') {
          // æ›´æ–°Deep MewtçŠ¶æ€
          const previousState = window.DEEP_MEWT_ENABLED;
          window.DEEP_MEWT_ENABLED = data.enabled;
          
          addMessageLog(`[çŠ¶æ€] Deep Mewt: ${data.enabled ? 'ON' : 'OFF'} (ä¹‹å‰: ${previousState ? 'ON' : 'OFF'})`);
          
          // æ›´æ–°æ˜¾ç¤º
          updateStatusDisplay();
          
          // çŠ¶æ€å˜åŒ–æ—¶çš„å¤„ç†é€»è¾‘
          if (data.enabled !== previousState) {
            addMessageLog('[å¤„ç†] Deep MewtçŠ¶æ€å·²åˆ‡æ¢ï¼Œå‡†å¤‡å¯ç”¨å¢å¼ºæ£€æµ‹æ¨¡å¼');
          }
          
          // å‘RNç¡®è®¤çŠ¶æ€æ›´æ–°
          sendToRN(
            `Deep Mewtæ¨¡å¼å·²${data.enabled ? 'å¯ç”¨' : 'å…³é—­'}`, 
            'system', 
            'idle', 
            { 
              deepMewtEnabled: window.DEEP_MEWT_ENABLED,
              statusUpdate: true 
            }
          );
        }
      } catch (e) {
        addMessageLog('[é”™è¯¯] æ¶ˆæ¯è§£æå¤±è´¥', e.message);
      }
    });
    
    // å‘é€Deep Mewtåˆ‡æ¢æ¶ˆæ¯
    function sendDeepMewtToggle(enabled) {
      const message = {
        type: 'deep_mewt_toggle',
        enabled: enabled,
        timestamp: Date.now()
      };
      
      addMessageLog(`[å‘é€] deep_mewt_toggle`, `enabled: ${enabled}`);
      
      // æ¨¡æ‹ŸRNå‘é€æ¶ˆæ¯åˆ°WebView
      window.postMessage(JSON.stringify(message), '*');
    }
    
    // å‘é€æ— æ•ˆæ¶ˆæ¯ï¼ˆæµ‹è¯•é”™è¯¯å¤„ç†ï¼‰
    function sendInvalidMessage() {
      const invalidMessage = "è¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„JSON";
      addMessageLog(`[å‘é€] æ— æ•ˆæ¶ˆæ¯`, invalidMessage);
      window.postMessage(invalidMessage, '*');
    }
    
    // æ·»åŠ æ¶ˆæ¯æ—¥å¿—
    function addMessageLog(title, content = '') {
      const time = new Date().toLocaleTimeString();
      messageLog.push({ time, title, content });
      
      if (messageLog.length > 20) messageLog.shift();
      
      const logDiv = document.getElementById('message-log');
      logDiv.innerHTML = messageLog.slice(-10).reverse()
        .map(entry => `
          <div class="log-entry">
            <span class="log-time">[${entry.time}]</span> ${entry.title}
            ${entry.content ? `<br><small style="color: #666;">${entry.content}</small>` : ''}
          </div>
        `).join('');
    }
    
    // æ·»åŠ RNå“åº”æ—¥å¿—
    function addRNResponseLog(title, content = '') {
      const time = new Date().toLocaleTimeString();
      rnResponseLog.push({ time, title, content });
      
      if (rnResponseLog.length > 20) rnResponseLog.shift();
      
      const logDiv = document.getElementById('rn-response-log');
      logDiv.innerHTML = rnResponseLog.slice(-10).reverse()
        .map(entry => `
          <div class="log-entry">
            <span class="log-time">[${entry.time}]</span> ${entry.title}
            ${entry.content ? `<br><small style="color: #666;">${entry.content}</small>` : ''}
          </div>
        `).join('');
    }
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatusDisplay() {
      const statusElement = document.getElementById('status-display');
      const updateElement = document.getElementById('last-update');
      
      statusElement.textContent = window.DEEP_MEWT_ENABLED ? 'ON' : 'OFF';
      statusElement.className = window.DEEP_MEWT_ENABLED ? 'status-on' : 'status-off';
      updateElement.textContent = new Date().toLocaleTimeString();
    }
    
    // åˆå§‹åŒ–æ˜¾ç¤º
    updateStatusDisplay();
    addMessageLog('[åˆå§‹åŒ–] Deep Mewté€šè®¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
  </script>
</body>
</html>